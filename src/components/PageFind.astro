---
import Search from "astro-pagefind/components/Search";

const navigationPages = [
  { title: "Home", url: "/" },
  { title: "404", url: "/404" },
  { title: "About", url: "/about" },
  { title: "Petals", url: "/petals" },
  { title: "Euthymia", url: "/euthymia" },
];
---

<div
  transition:persist
  id="backdrop"
  class="pointer-events-none invisible fixed left-0 top-0 z-40 flex h-screen w-full justify-center bg-black/60 p-6 backdrop-blur-sm"
>
  <div
    id="pagefind-container"
    class="relative flex h-fit max-h-[80%] w-full max-w-screen-sm flex-col overflow-auto rounded border border-white/20 bg-transparent p-4 shadow-xl"
  >
    <!-- STATIC Pagefind -->
    <Search
      id="search"
      className="pagefind-ui"
      uiOptions={{
        showImages: true,
        excerptLength: 16,
        resetStyles: false,
      }}
    />

    <div class="mt-2 flex justify-between"></div>

    <div class="mt-2 flex items-baseline justify-between text-xs text-white">
      <span id="current-time" class="font-mono tabular-nums"></span>
      <span>Press <kbd class="align-baseline">Esc</kbd></span>
    </div>
  </div>
</div>

<script>
  const ase = document.getElementById("ase");
  const backdrop = document.getElementById("backdrop");

  function openPagefind() {
    const input = document.querySelector("#search input");
    backdrop?.classList.remove("invisible", "pointer-events-none");
    backdrop?.classList.add("visible");
    input?.focus();
  }

  function closePagefind() {
    const input = document.querySelector("#search input");
    if (input) input.value = "";
    backdrop?.classList.add("invisible", "pointer-events-none");
    backdrop?.classList.remove("visible");
  }

  ase?.addEventListener("click", (e) => {
    e.preventDefault();
    openPagefind();
  });

  document.addEventListener("keydown", (e) => {
    if (e.key === "/" || ((e.metaKey || e.ctrlKey) && e.key === "k")) {
      e.preventDefault();
      openPagefind();
    }
    if (e.key === "Escape") {
      closePagefind();
    }
  });

  backdrop?.addEventListener("click", (e) => {
    if (!e.target.closest("#pagefind-container")) {
      closePagefind();
    }
  });

  function updateTime() {
    const el = document.getElementById("current-time");
    if (!el) return;
    el.textContent = new Intl.DateTimeFormat(undefined, {
      hour: "2-digit",
      minute: "2-digit",
      second: "2-digit",
      hour12: true,
    }).format(new Date());
  }

  updateTime();
  setInterval(updateTime, 1000);
</script>
