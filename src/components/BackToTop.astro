---
const SHOW_AFTER = 240;
---

<div id="back-to-top" aria-hidden="true" class="back-to-top-indicator">
  <svg
    viewBox="0 0 24 24"
    width="18"
    height="18"
    fill="none"
    stroke="currentColor"
    stroke-width="1.8"
    stroke-linecap="round"
    stroke-linejoin="round"
  >
    <path d="M12 19V5"></path>
    <path d="M5 12l7-7 7 7"></path>
  </svg>
</div>

<script define:vars={{ SHOW_AFTER }}>
  const el = document.getElementById("back-to-top");
  const root = document.documentElement;

  function updateBackToTop() {
    const y =
      window.scrollY ||
      document.documentElement.scrollTop ||
      document.body.scrollTop ||
      0;

    const active = y > SHOW_AFTER;

    el.classList.toggle("active", active);
    root.toggleAttribute("data-backtotop", active);
  }

  // Always attach listeners once
  window.addEventListener("scroll", updateBackToTop, { passive: true });
  document.addEventListener("astro:page-load", updateBackToTop);
  document.addEventListener("astro:after-swap", updateBackToTop);

  updateBackToTop();

  el.addEventListener("click", () => {
    window.scrollTo({ top: 0, behavior: "smooth" });
  });
</script>

<style>
  .back-to-top-indicator {
    display: flex;
    align-items: center;
    justify-content: center;

    opacity: 0;
    pointer-events: none;
    transition: opacity 200ms ease;
    color: currentColor;
  }

  .back-to-top-indicator.active {
    opacity: 1;
    pointer-events: auto;
  }

  @media (prefers-reduced-motion: reduce) {
    .back-to-top-indicator {
      transition: none;
    }
  }
</style>
