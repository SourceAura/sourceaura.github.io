---
import { SITE } from "@consts";
---

<a
  id="ase"
  href="/"
  aria-label={SITE.ALIAS}
  role="button"
  tabindex="0"
  data-role="search-pill"
  class="group relative flex items-center
    overflow-hidden rounded-full
    border border-black/15
    px-3 py-1.5
    text-xs font-semibold
    transition-colors duration-300
    hover:bg-black/5
    focus-visible:bg-black/5
    dark:border-white/20
    dark:hover:bg-white/5
    dark:focus-visible:bg-white/5"
  style="background-color: transparent; text-decoration: none;"
>
  <span
    id="ase-label"
    class="select-none tracking-wide opacity-80 transition group-hover:opacity-100"
  >
    {SITE.ALIAS}
  </span>
</a>

<script>
  const ase = document.getElementById("ase");

  if (ase) {
    let mode = "search";

    function setSearchMode() {
      if (mode === "search") return;
      mode = "search";

      ase.id = "ase";
      ase.dataset.role = "search-pill";
      ase.href = "/";
      ase.setAttribute("aria-label", "Open search");
    }

    function setPetalMode() {
      if (mode === "petal") return;
      mode = "petal";

      // Temporarily suspend PageFind identity
      ase.removeAttribute("id");
      ase.removeAttribute("data-role");
      ase.href = "/petals";
      ase.setAttribute("aria-label", "Back to petals");
    }

    function updateMode() {
      document.body.dataset.view === "petal" ? setPetalMode() : setSearchMode();
    }

    // Initial state
    updateMode();

    // Watch for layout/context changes
    new MutationObserver(updateMode).observe(document.body, {
      attributes: true,
      attributeFilter: ["data-view"],
    });

    // Default activation behavior
    ase.addEventListener("click", (e) => {
      if (mode === "search") {
        e.preventDefault();
        window.togglePagefind
          ? window.togglePagefind()
          : window.dispatchEvent(new Event("open-pagefind"));
      }
    });

    ase.addEventListener("keydown", (e) => {
      if ((e.key === "Enter" || e.key === " ") && mode === "search") {
        e.preventDefault();
        window.togglePagefind
          ? window.togglePagefind()
          : window.dispatchEvent(new Event("open-pagefind"));
      }
    });
  }
</script>
