---
/*
Orb:
Plasma Orb - Petal
*/
import type { CollectionEntry } from "astro:content";
import Container from "@components/Container.astro";
const {
  width = 720,
  height = 416,

  // 20% smaller than 280
  sphereRad = 111,
  radiusSp = 1,
  particlesPerFrame = 9,

  // Glow tuning (dark mode only)
  glowBlur = 9,
  glowStrength = 0.55, // alpha multiplier in dark mode
} = Astro.props;

const uid = `ps_${Math.random().toString(16).slice(2)}`;
const canvasId = `${uid}_canvas`;
interface Props {
  post: CollectionEntry<"petals">;
  type?: "text" | "audio" | "video" | "photo" | "project";
}

const { post } = Astro.props;

/* Extract first markdown image */
let imageSrc: string | null = null;

const match = post.body.match(/!\[.*?\]\((.*?)\)/);
if (match?.[1]) {
  const raw = match[1].trim();
  imageSrc =
    raw.startsWith("http") || raw.startsWith("/")
      ? raw
      : `/images/${raw.replace(/^\.?\//, "")}`;
}
---

<Container>
  <article
    class="orb-card"
    data-orb
    data-has-image={imageSrc ? "true" : "false"}
    data-seed={Math.floor(Math.random() * 1000)}
  >
    <div class="ps-wrap" data-ps-root={uid}>
      <canvas id={canvasId} width={width} height={height}></canvas>
    </div>
  </article>
</Container>
