---
/*
Connect: a component that displays whoami.
*/
import Link from "./Link.astro";
import { HERO, SITE } from "@consts";
---

<div class="connect" id="connectRoot">
  <!-- Default text -->
  <button
    id="connectToggle"
    class="connect-trigger is-visible text-sm opacity-80"
    aria-expanded="false"
  >
    {SITE.TITLE} | ü´Ä ‚Ä¢ ü´Å ‚Ä¢ üß† | ¬© {new Date().getFullYear()}
  </button>

  <!-- Links -->
  <div id="connectCenter" class="connect-center">
    <ul>
      <li class="connect-row">
        {HERO.GITHUB && (
          <Link href={`https://${HERO.GITHUB}`} aria-label="GitHub">
            <!-- GitHub (original animated) -->
            <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24">
              <mask id="lineMdGithubLoop0">
                <g fill="#fff">
                  <ellipse cx="9.5" cy="9" rx="1.5" ry="1" />
                  <ellipse cx="14.5" cy="9" rx="1.5" ry="1" />
                </g>
              </mask>
              <g fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path
                  stroke-dasharray="32"
                  stroke-dashoffset="32"
                  d="M12 4c-4.4 0-8 3-8 7c0 3.1 1.6 5.7 4 6.5">
                  <animate attributeName="stroke-dashoffset" dur="0.7s" values="32;0" fill="freeze" />
                </path>
              </g>
              <rect
                x="8"
                y="11"
                width="8"
                height="4"
                fill="currentColor"
                mask="url(#lineMdGithubLoop0)">
                <animate
                  attributeName="y"
                  dur="10s"
                  repeatCount="indefinite"
                  values="11;11;7;7;11;11"
                  keyTimes="0;0.45;0.46;0.54;0.55;1" />
              </rect>
            </svg>
          </Link>
        )}

        {HERO.MASTODON && (
          <Link href={`https://${HERO.MASTODON}`} aria-label="Mastodon">
            <!-- Mastodon (original animated) -->
            <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24">
              <g fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path
                  stroke-dasharray="88"
                  stroke-dashoffset="88"
                  d="M15.5 21.5c-10.5 2.5-12.5-2.5-12.5-8.5v-3c0-6 2.5-7 7-7h4c4.5 0 7 1.5 7 5.5v4c0 6.5-10 4-13.5 4">
                  <animate attributeName="stroke-dashoffset" dur="0.6s" values="88;0" fill="freeze" />
                </path>
                <path
                  stroke-dasharray="32"
                  stroke-dashoffset="32"
                  d="M7 13.5v-5.5s.5-2 2.5-2s2.5 2 2.5 2v2.5V8s.5-2 2.5-2s2.5 2 2.5 2v5.5">
                  <animate attributeName="stroke-dashoffset" begin="0.7s" dur="0.7s" values="32;0" fill="freeze" />
                </path>
              </g>
            </svg>
          </Link>
        )}

        {HERO.TWITTER && (
          <Link href={`https://${HERO.TWITTER}`} aria-label="Twitter">
            <!-- Twitter / X (original animated) -->
            <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24">
              <g fill="currentColor">
                <path d="M1 2h2.5L3.5 2h-2.5zM5.5 2h2.5L7.2 2h-2.5z">
                  <animate
                    attributeName="d"
                    dur="0.4s"
                    fill="freeze"
                    values="
                      M1 2h2.5L3.5 2h-2.5zM5.5 2h2.5L7.2 2h-2.5z;
                      M1 2h2.5L18.5 22h-2.5zM5.5 2h2.5L23 22h-2.5z" />
                </path>
                <path d="M3 2h5v0h-5zM16 22h5v0h-5z">
                  <animate
                    attributeName="d"
                    begin="0.4s"
                    dur="0.4s"
                    fill="freeze"
                    values="
                      M3 2h5v0h-5zM16 22h5v0h-5z;
                      M3 2h5v2h-5zM16 22h5v-2h-5z" />
                </path>
                <path d="M18.5 2h3.5L22 2h-3.5z">
                  <animate
                    attributeName="d"
                    begin="0.5s"
                    dur="0.4s"
                    fill="freeze"
                    values="
                      M18.5 2h3.5L22 2h-3.5z;
                      M18.5 2h3.5L5 22h-3.5z" />
                </path>
              </g>
            </svg>
          </Link>
        )}

        <Link href={`mailto:${SITE.EMAIL}`} aria-label="Email">
          <!-- Email (original animated) -->
          <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24">
            <mask id="lineMdEmailArrowRight0">
              <g fill="none" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path stroke-dasharray="64" stroke-dashoffset="64" d="M4 5h16v14H4z">
                  <animate attributeName="stroke-dashoffset" dur="0.6s" values="64;0" fill="freeze" />
                </path>
                <path stroke-dasharray="24" stroke-dashoffset="24" d="M4 6.5l8 5.5l8-5.5">
                  <animate attributeName="stroke-dashoffset" begin="0.6s" dur="0.2s" values="24;0" fill="freeze" />
                </path>
              </g>
            </mask>
            <rect width="24" height="24" fill="currentColor" mask="url(#lineMdEmailArrowRight0)" />
          </svg>
        </Link>

        <Link href="/petals" aria-label="Petals">
          <!-- Petals (original animated) -->
          <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24">
            <g fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path stroke-dasharray="72" stroke-dashoffset="72" d="M3 19.5v-15.5h18v12h-14.5">
                <animate attributeName="stroke-dashoffset" dur="0.6s" values="72;0" fill="freeze" />
              </path>
              <path stroke-dasharray="10" stroke-dashoffset="10" d="M8 7h8">
                <animate attributeName="stroke-dashoffset" begin="0.7s" dur="0.2s" values="10;0" fill="freeze" />
              </path>
              <path stroke-dasharray="10" stroke-dashoffset="10" d="M8 10h8">
                <animate attributeName="stroke-dashoffset" begin="1s" dur="0.2s" values="10;0" fill="freeze" />
              </path>
              <path stroke-dasharray="6" stroke-dashoffset="6" d="M8 13h4">
                <animate attributeName="stroke-dashoffset" begin="1.3s" dur="0.2s" values="6;0" fill="freeze" />
              </path>
            </g>
          </svg>
        </Link>
      </li>
    </ul>
  </div>
</div>

<script is:inline>
  const root = document.getElementById("connectRoot");
  const toggle = document.getElementById("connectToggle");
  const center = document.getElementById("connectCenter");

  let open = false;

  const setOpen = (next) => {
    open = next;
    toggle.setAttribute("aria-expanded", String(open));
    toggle.classList.toggle("is-visible", !open);
    center.classList.toggle("is-visible", open);
  };

  toggle.addEventListener("click", (e) => {
    e.stopPropagation();
    setOpen(true);
  });

  // Click / touch anywhere outside closes
  document.addEventListener("pointerdown", (e) => {
    if (!open) return;
    if (!root.contains(e.target)) setOpen(false);
  });

  // ESC closes
  document.addEventListener("keydown", (e) => {
    if (open && e.key === "Escape") setOpen(false);
  });

  // Route change closes (Astro)
  document.addEventListener("astro:before-swap", () => {
    if (open) setOpen(false);
  });
</script>

<style>
.connect {
  position: relative;
  display: inline-flex;
  align-items: center;
  height: 32px;          /* match footer control rail */
}

  .connect-trigger,
  .connect-center {
    position: absolute;
    left: 0;
    top: 50%;
    transform: translateY(-50%) translateX(-36px);
    opacity: 0;
    pointer-events: none;
    transition:
      transform 0.6s cubic-bezier(0.22, 1, 0.36, 1),
      opacity 0.35s ease;
  }

  .is-visible {
    transform: translateY(-50%) translateX(0);
    opacity: 1;
    pointer-events: auto;
  }

  .connect-trigger {
    background: none;
    border: none;
    padding: 0;
    cursor: pointer;
    white-space: nowrap;
    z-index: 2;
  }

  .connect-row {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    line-height: 1;
    white-space: nowrap;
  }

  .connect-row :global(svg) {
    display: block;
    width: 1em;
    height: 1em;
  }

  @media (prefers-reduced-motion: reduce) {
    .connect-trigger,
    .connect-center {
      transition: none;
      transform: translateY(-50%);
      opacity: 1;
    }
  }
</style>
