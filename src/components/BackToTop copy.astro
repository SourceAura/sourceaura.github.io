---
/* BackToTop.astro */
---

<button
  id="back-to-top"
  aria-label="Back to top"
  class="group fixed bottom-6 right-6 z-50 flex
    hidden w-fit translate-y-2 flex-nowrap
    items-center rounded border
    border-black/15 py-1.5 pl-8
    pr-3
    text-sm opacity-0
    transition-all duration-300 ease-out
    hover:bg-black/5 hover:text-black
    focus-visible:bg-black/5 focus-visible:text-black
    dark:border-white/20
    dark:hover:bg-white/5 dark:hover:text-white
    dark:focus-visible:bg-white/5 dark:focus-visible:text-white"
>
  <svg
    xmlns="http://www.w3.org/2000/svg"
    viewBox="0 0 24 24"
    class="absolute left-2 top-1/2 size-4 -translate-y-1/2 rotate-90 fill-none stroke-current stroke-2"
  >
    <line
      x1="5"
      y1="12"
      x2="19"
      y2="12"
      class="translate-x-2 scale-x-0 transition-transform duration-300
        group-hover:translate-x-0 group-hover:scale-x-100
        group-focus-visible:translate-x-0 group-focus-visible:scale-x-100"
    ></line>
    <polyline
      points="12 5 5 12 12 19"
      class="translate-x-1 transition-transform duration-300
        group-hover:translate-x-0 group-focus-visible:translate-x-0"
    ></polyline>
  </svg>

  <span>Back to top</span>
</button>

<script is:inline>
  const btn = document.getElementById("back-to-top");
  if (!btn) return;

  const SHOW_AT = 480;
  let lastY = window.scrollY;

  function isScrollable() {
    return document.documentElement.scrollHeight > window.innerHeight + 40;
  }

  function show() {
    btn.classList.remove("hidden");
    requestAnimationFrame(() => {
      btn.classList.remove("opacity-0", "translate-y-2");
      btn.classList.add("opacity-100", "translate-y-0");
    });
  }

  function hide() {
    btn.classList.remove("opacity-100", "translate-y-0");
    btn.classList.add("opacity-0", "translate-y-2");
    setTimeout(() => btn.classList.add("hidden"), 250);
  }

  function onScroll() {
    const y = window.scrollY;
    const scrollingUp = y < lastY;
    lastY = y;

    if (!isScrollable() || y < SHOW_AT) {
      hide();
      return;
    }

    if (scrollingUp) show();
    else hide();
  }

  btn.addEventListener("click", () => {
    window.scrollTo({ top: 0, behavior: "smooth" });
  });

  window.addEventListener("scroll", onScroll, { passive: true });
  window.addEventListener("resize", onScroll);

  onScroll();
</script>
