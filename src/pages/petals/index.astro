---
import type { CollectionEntry } from "astro:content";
import Layout from "@layouts/Layout.astro";
import Container from "@components/Container.astro";
import PetalCard from "@components/PetalCard.astro";
import { getCollection } from "astro:content";
import { getRandomSize } from "@lib/utils";

const posts: CollectionEntry<"petals">[] = (await getCollection("petals"))
  .filter((post) => !post.data.draft)
  .sort(
    (a, b) => new Date(b.data.date).valueOf() - new Date(a.data.date).valueOf(),
  );
---

<Layout
  title="Petals Gallery"
  description="A collection of my projects and experiments"
>
  <Container>
    <!-- âœ… PAGEFIND FIX: searchable container -->
    <div class="petal-container" data-pagefind-body>
      <div class="petal-grid">
        {
          posts.map((post) => (
            <div class={`petal-item ${getRandomSize()}`}>
              <PetalCard post={post} />
            </div>
          ))
        }
      </div>
    </div>
  </Container>
</Layout>

<style>
  .petal-container {
    width: 340px;
    height: 210px;
    overflow: auto;
    padding: 0.25rem;
    -webkit-overflow-scrolling: touch;
    scrollbar-width: none;
    -ms-overflow-style: none;
    border: 1px solid #ccc;
    border-radius: 8px;
  }

  .petal-container::-webkit-scrollbar {
    display: none;
  }

  .petal-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
    grid-auto-flow: dense;
    grid-gap: 0.25rem;
    width: max-content;
    padding: 1rem;
  }

  .petal-item {
    break-inside: avoid;
  }

  .small {
    grid-column: span 1;
    grid-row: span 1;
  }

  .medium {
    grid-column: span 2;
    grid-row: span 2;
  }

  .large {
    grid-column: span 3;
    grid-row: span 3;
  }
</style>
