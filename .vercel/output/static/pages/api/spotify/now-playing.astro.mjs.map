{"version":3,"file":"now-playing.astro.mjs","sources":["../../../../../../src/pages/api/spotify/now-playing.ts"],"sourcesContent":["import type { APIRoute } from \"astro\";\n\n// â¬‡ï¸ MUST match named export exactly\nimport { getNowPlaying } from \"../../../utils/spotify\";\n\nexport const prerender = false;\n\nfunction json(data: any) {\n  return new Response(JSON.stringify(data), {\n    headers: {\n      \"Content-Type\": \"application/json\",\n      \"Cache-Control\": \"no-store\",\n    },\n  });\n}\n\nexport const GET: APIRoute = async () => {\n  console.log(\"ðŸ”¥ /api/spotify/now-playing HIT\");\n\n  try {\n    const response = await getNowPlaying();\n\n    if (!response) {\n      return json({ isPlaying: false, debug: \"no-response\" });\n    }\n\n    if (response.status === 204) {\n      return json({ isPlaying: false, debug: \"204\" });\n    }\n\n    if (!response.ok) {\n      return json({ isPlaying: false, debug: \"not-ok\" });\n    }\n\n    const data = await response.json();\n\n    if (!data?.item) {\n      return json({ isPlaying: false, debug: \"no-item\" });\n    }\n\n    return json({\n      isPlaying: Boolean(data.is_playing),\n      title: data.item.name,\n      artist: data.item.artists.map((a: any) => a.name).join(\", \"),\n      albumImageUrl: data.item.album.images[0]?.url ?? \"\",\n      songUrl: data.item.external_urls.spotify,\n      debug: \"ok\",\n    });\n  } catch (err) {\n    console.error(\"ðŸ’¥ Unhandled API error:\", err);\n    return json({ isPlaying: false, debug: \"exception\" });\n  }\n};\n"],"names":[],"mappings":"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"}