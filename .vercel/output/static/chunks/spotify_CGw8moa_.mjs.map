{"version":3,"file":"spotify_CGw8moa_.mjs","sources":["../../../../src/utils/spotify.ts"],"sourcesContent":["// src/utils/spotify.ts\n\nconst CLIENT_ID = import.meta.env.SPOTIFY_CLIENT_ID;\nconst REFRESH_TOKEN = import.meta.env.SPOTIFY_REFRESH_TOKEN;\n\nconst TOKEN_ENDPOINT = \"https://accounts.spotify.com/api/token\";\nconst NOW_PLAYING_ENDPOINT =\n  \"https://api.spotify.com/v1/me/player/currently-playing\";\n\nif (!CLIENT_ID || !REFRESH_TOKEN) {\n  console.error(\"‚ùå Missing Spotify env vars\");\n}\n\n// ‚¨áÔ∏è EXPLICIT NAMED EXPORT\nexport async function getAccessToken(): Promise<string | null> {\n  console.log(\"üîê Attempting to refresh Spotify access token\");\n\n  const res = await fetch(TOKEN_ENDPOINT, {\n    method: \"POST\",\n    headers: { \"Content-Type\": \"application/x-www-form-urlencoded\" },\n    body: new URLSearchParams({\n      client_id: CLIENT_ID,\n      grant_type: \"refresh_token\",\n      refresh_token: REFRESH_TOKEN,\n    }),\n  });\n\n  const raw = await res.text();\n  console.log(\"üì® Spotify token raw response:\", raw);\n\n  let data: any;\n  try {\n    data = JSON.parse(raw);\n  } catch {\n    console.error(\"‚ùå Token response not JSON\");\n    return null;\n  }\n\n  if (!res.ok || data.error || !data.access_token) {\n    console.error(\"‚ùå Token refresh failed:\", data);\n    return null;\n  }\n\n  console.log(\"‚úÖ Spotify access token refreshed\");\n  return data.access_token;\n}\n\n// ‚¨áÔ∏è EXPLICIT NAMED EXPORT\nexport async function getNowPlaying(): Promise<Response | null> {\n  console.log(\"üéµ getNowPlaying() called\");\n\n  const accessToken = await getAccessToken();\n  if (!accessToken) {\n    console.warn(\"‚ö† No access token, skipping Spotify request\");\n    return null;\n  }\n\n  return fetch(NOW_PLAYING_ENDPOINT, {\n    headers: {\n      Authorization: `Bearer ${accessToken}`,\n    },\n  });\n}\n"],"names":[],"mappings":"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"}